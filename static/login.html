<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gladia Realtime Demo - Access Required</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="shortcut icon" type="image/png" href="/logo.png">
    <link rel="apple-touch-icon" href="/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/login.css">
</head>
<body>
    <div class="login-wrapper">
        <div class="login-container">
            <div class="brand">
                <div class="brand-icon">
                    <a href="https://www.gladia.io" target="_blank" rel="noopener noreferrer">
                        <img src="/logo.png" alt="Gladia Logo" width="40" height="40">
                    </a>
                </div>
                <div class="brand-text">
                    <h1 class="brand-title">GLADIA REALTIME DEMO</h1>
                    <p class="brand-subtitle">Live Transcription</p>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">Access required</div>
                <p class="form-hint">Enter your access key to continue</p>
            </div>
            
            <form class="login-form" id="login-form">
                <div class="password-wrapper">
                    <input type="password" id="access-key" class="login-input" placeholder="Access key" required autocomplete="off">
                    <button type="button" class="toggle-password" id="toggle-password" aria-label="Show password">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </button>
                </div>
                
                <div id="error-message" class="login-error"></div>
                
                <button type="submit" class="start-button" id="submit-btn" disabled>
                    <svg class="button-icon" width="18" height="18" viewBox="0 0 20 20" fill="none">
                        <path d="M4 10h12m0 0l-4-4m4 4l-4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="button-text">Access demo</span>
                </button>
            </form>
        </div>
    </div>

    <script>
        const form = document.getElementById('login-form')
        const input = document.getElementById('access-key')
        const submitBtn = document.getElementById('submit-btn')
        const errorMsg = document.getElementById('error-message')
        const toggleBtn = document.getElementById('toggle-password')
        const buttonText = submitBtn.querySelector('.button-text')

        toggleBtn.addEventListener('click', () => {
            const isPassword = input.type === 'password'
            input.type = isPassword ? 'text' : 'password'
            toggleBtn.innerHTML = isPassword 
                ? '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"/><path d="M14.084 14.158a3 3 0 0 1-4.242-4.242"/><path d="M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"/><path d="m2 2 20 20"/></svg>'
                : '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/><circle cx="12" cy="12" r="3"/></svg>'
            toggleBtn.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password')
        })

        // Enable/disable button based on input value
        const updateButtonState = () => {
            submitBtn.disabled = !input.value.trim()
        }

        input.addEventListener('input', updateButtonState)

        // Check initial state
        updateButtonState()

        form.addEventListener('submit', async (e) => {
            e.preventDefault()
            
            const key = input.value.trim()
            if (!key) return

            submitBtn.disabled = true

            try {
                const response = await fetch('/verify-access', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ key })
                })

                if ((await response.json()).success) {
                    window.location.href = '/'
                    return
                }

                errorMsg.textContent = 'Invalid access key. Please try again.'
                if (!errorMsg.classList.contains('show')) {
                    errorMsg.classList.add('show')
                } else {
                    errorMsg.classList.remove('shake')
                    void errorMsg.offsetWidth
                    errorMsg.classList.add('shake')
                }
                input.value = ''
                submitBtn.disabled = true
                input.focus()
            } catch {
                errorMsg.textContent = 'Connection error. Please try again.'
                if (!errorMsg.classList.contains('show')) {
                    errorMsg.classList.add('show')
                } else {
                    errorMsg.classList.remove('shake')
                    void errorMsg.offsetWidth
                    errorMsg.classList.add('shake')
                }
                submitBtn.disabled = false
            }
        })

        input.focus()
    </script>
</body>
</html>

